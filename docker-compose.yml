services:
  next-app:
    build:
      context: ./next-app
      dockerfile: prod.Dockerfile
      args:
        ENV_VARIABLE: ${ENV_VARIABLE}
        NEXT_PUBLIC_ENV_VARIABLE: ${NEXT_PUBLIC_ENV_VARIABLE}
    deploy:
      replicas: 1
      restart_policy:
        condition: any
    # เปิดพอร์ตบนโฮสต์ไว้รับจาก Cloudflared โดยตรง (ไม่ผ่าน Traefik)
    ports:
      - "8082:3000"
    networks:
      - webnet
    # ห้ามมี traefik labels ในไฟล์นี้ (เอาออกให้หมด)

networks:
  webnet:
    driver: overlay
